# Dual Palette Modes: Contrast-Matched & Brightness-Matched

## Problem

The Simple color picker pairs light/dark theme colors by **brightness** — both variants go dark→light from top to bottom. This means:
- Row 0 (darkest): high contrast on light background, **low** contrast on dark background
- Row 5 (lightest): low contrast on light background, **high** contrast on dark background

Colors at the same grid position have mismatched contrast between themes.

## Solution

Offer two palette modes in the Simple picker that users can toggle between:

1. **Brightness-matched** (current behavior) — both theme variants have similar brightness. Useful when the user wants the color to "look the same" across themes.
2. **Contrast-matched** (new) — dark theme variants are inverted so both themes have similar contrast against their backgrounds. Useful when the user wants consistent readability/visibility.

## Implementation

### 1. Create contrast-matched palette (`ExtendedPalette.ts`)

Add a new export `EXTENDED_PALETTE_CONTRAST` generated by reversing the `dark` values within each hue column (8 columns × 6 rows).

For each column, collect the 6 dark values and reverse their order:
- Row 0 gets the lightest dark value (high contrast on dark bg)
- Row 5 gets the darkest dark value (low contrast on dark bg)

**Chromatic columns** (Red, Orange, Green, Teal, Blue, Pink): straightforward reversal works since dark values are monotonically ordered.

**Purple column**: current Row 0 dark (`#818cf8`) is lighter than Row 1 dark (`#7c3aed`). After reversal, sort by luminance descending to maintain a smooth gradient.

**Neutral column**: current dark values don't span a useful range for inversion (all in the light-to-bright range). Instead, mirror the light theme values:
| Row | Light (kept) | Dark (new) |
|-----|-------------|------------|
| 0 Black | `#1a1a1a` | `#f5f5f4` |
| 1 Charcoal | `#374151` | `#d1d5db` |
| 2 Gray | `#6b7280` | `#9ca3af` |
| 3 Silver | `#9ca3af` | `#6b7280` |
| 4 Light Gray | `#d1d5db` | `#4b5563` |
| 5 White | `#f5f5f4` | `#2d2d2d` |

Export a type and both palettes:
```ts
export type PaletteMode = "brightness" | "contrast";
export const EXTENDED_PALETTE: SemanticColor[];          // brightness-matched (unchanged)
export const EXTENDED_PALETTE_CONTRAST: SemanticColor[]; // contrast-matched (new)
```

### 2. Add toggle to ColorPickerPanel

Add a small toggle control above the swatch grid in the Simple mode section. Two segmented buttons: **"Brightness"** / **"Contrast"** (or icons).

When toggled:
- Rebuild the swatch grid from the selected palette
- Preserve the current selection if the same color position exists
- Default to "Contrast" mode (the more useful default for handwriting)

### 3. Wire palette mode into the panel

In `ColorPickerPanel.buildSimpleMode()`:
- Accept a `paletteMode` parameter or read from instance state
- Use `EXTENDED_PALETTE` or `EXTENDED_PALETTE_CONTRAST` accordingly
- Rebuild swatches on toggle (clear + repopulate the grid container)

### 4. No settings persistence needed (session state is fine)

The palette mode is a picker-time preference, not a document property. The selected **color** is what gets saved (as dual-hex). The palette mode just changes which colors are offered. Default to "Contrast" and let the user toggle to "Brightness" if needed.

## Files Changed

| File | Change |
|------|--------|
| `src/color/ExtendedPalette.ts` | Add `PaletteMode` type, `EXTENDED_PALETTE_CONTRAST` constant |
| `src/view/toolbar/ColorPickerPanel.ts` | Add toggle UI, wire palette switching |
| `src/color/ExtendedPalette.test.ts` | Add tests for the contrast palette (same structural validations) |

## Notes

- The `light` values never change — only the `dark` column is reordered
- Existing saved colors (dual-hex strings) are unaffected since they store literal hex values
- The `COLOR_PALETTE` in `ColorPalette.ts` is unchanged (it's the legacy 10-color set)
- Middle rows (Row 2/3) in chromatic columns will converge — the reversed dark value equals the light value. This is expected at the crossover point

# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Instructions
- Always write plans to `Claude/Plans` as a markdown file in the format `{YYYY-MM-DD}-{plan name}.md`
- Always write research to `Claude/Research` as a markdown file in the format `{YYYY-MM-DD}-{research title}.md`
- Always use Yarn. Never use npm.
- Never implement a feature directly. Always create a plan first and write it to the `Claude/Plans` folder.

## Project Overview

ObsidianPaper is an Obsidian plugin for handwriting notes with an Apple Pencil. The goal is to create a paper-like writing experience within Obsidian, going beyond existing drawing plugins by prioritizing a natural writing feel.

## Build Commands

```bash
yarn install              # Install dependencies
yarn dev                  # Development build with watch mode
yarn build                # Production build (type check + minified bundle)
yarn lint                 # Run ESLint
yarn test                 # Run all tests
yarn test:watch           # Run tests in watch mode
yarn test:coverage        # Run tests with coverage report
npx jest path/to/file     # Run a single test file
npx jest -t "test name"   # Run tests matching a pattern
```

## Architecture

### Obsidian Plugin Structure
- `src/main.ts` — Plugin entry point extending Obsidian's `Plugin` class with `onload()`/`onunload()` lifecycle methods
- `manifest.json` — Plugin metadata (id, name, version, minAppVersion, author)
- `versions.json` — Maps plugin versions to minimum Obsidian app versions
- `main.js` — Bundled output generated by esbuild (not checked in)

### Build System
- esbuild bundles `src/main.ts` → `main.js` (CommonJS, ES2018 target)
- External dependencies (not bundled): `obsidian`, `electron`, `@codemirror/*`, `@lezer/*`
- TypeScript strict mode with `noImplicitAny`, `strictNullChecks`, `noUncheckedIndexedAccess`

### Testing
- Jest with ts-jest and jsdom environment
- `__mocks__/obsidian.ts` provides mock implementations of Obsidian API classes
- Tests live alongside source files as `*.test.ts` / `*.test.tsx`
- Module name mapper redirects `obsidian` imports to mock

### Linting
- ESLint flat config (`eslint.config.mts`) with `typescript-eslint` and `eslint-plugin-obsidianmd`
- Relaxed type-safety rules for test files

### Plugin Registration Patterns
- `addCommand()` — Register commands accessible via command palette
- `addSettingTab()` — Register settings UI
- `registerEvent()` — Listen for file/editor events
- `loadData()` / `saveData()` — Persist plugin settings

## Reference Projects

Sibling projects in the parent directory provide implementation examples:
- `../ObsidianWordsmith` — Plugin with services architecture, caching, and comprehensive Jest tests
- `../ObsidianNewNoteTemplate` — Complex plugin with React UI, CodeMirror editor extensions, and `@testing-library/react`
- `../ObsidianSVGExtractor` — Simple plugin with ESLint + CI setup
